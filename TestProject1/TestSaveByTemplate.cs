using MiniExcelLibs;
using MiniExcelLibs.OpenXml;
using MiniExcelTests.Helpers;

namespace MiniExcelTests;

public class TestSaveByTemplate
{
    private const string ValidFileTwoSheets =
        "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";

    // x.CID, x.DID
    private const string BookWithFormula =
        "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";

    private const string SomeValue = "123";

    public TestSaveByTemplate()
    {
        System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);
    }

    public static byte[] DecodeBase64(string value)
    {
        return string.IsNullOrEmpty(value) ? Array.Empty<byte>() : Convert.FromBase64String(value);
    }

    [Fact]
    public async Task Test_Applies_Ok_SingleSheet()
    {
        var stream = new MemoryStream();
        var dict = new Dictionary<string, object>
        {
            ["CID"] = SomeValue
        };
        const string sheet = "sheet1.xml";
        await stream.SaveAsByTemplateAsync(DecodeBase64(ValidFileTwoSheets), dict, new OpenXmlConfiguration { Sheet = sheet });
        stream.Position = 0;
        Assert.True(stream.Length > 0);
        var wasReplaced = ExcelContainsChecker.Contains(stream.ToArray(), new List<string> { SomeValue });
        Assert.True(wasReplaced);
    }

    [Fact]
    public async Task Test_NotApplies_Ok_OtherSheet()
    {
        var stream = new MemoryStream();
        var dict = new Dictionary<string, object>
        {
            ["CID"] = SomeValue
        };
        const string sheet = "s2";
        await stream.SaveAsByTemplateAsync(DecodeBase64(ValidFileTwoSheets), dict, new OpenXmlConfiguration { Sheet = sheet });
        stream.Position = 0;
        Assert.True(stream.Length > 0);
        var wasReplaced = ExcelContainsChecker.Contains(stream.ToArray(), new List<string> { SomeValue });
        Assert.False(wasReplaced);
    }

    [Fact]
    public async Task Test_Applies_Ok_NoSheet()
    {
        var stream = new MemoryStream();
        var dict = new Dictionary<string, object>
        {
            ["CID"] = SomeValue
        };
        await stream.SaveAsByTemplateAsync(DecodeBase64(ValidFileTwoSheets), dict);
        stream.Position = 0;
        Assert.True(stream.Length > 0);
        var wasReplaced = ExcelContainsChecker.Contains(stream.ToArray(), new List<string> { SomeValue });
        Assert.True(wasReplaced);
    }

    [Fact]
    public async Task Test_Applies_Ok_Formula()
    {
        var stream = new MemoryStream();
        var dict = new Dictionary<string, object>
        {
            { "x", new object[]
            {
                new { CID = 123, DID = 124 },
                new { CID = 125, DID = 126 }
            }}
        };
        await stream.SaveAsByTemplateAsync(DecodeBase64(BookWithFormula), dict);
        stream.Position = 0;
        Assert.True(stream.Length > 0);
        var newValues = ExcelContainsChecker.GetExistingValues(stream.ToArray());
        // replaced successfully
        Assert.True(newValues.ContainsKey("125"));

        var ufolder = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
        /*var fileStream = File.Create(ufolder + "\\Documents\\file.xlsx");
        stream.Seek(0, SeekOrigin.Begin);
        await stream.CopyToAsync(fileStream);
        fileStream.Close();*/
    }
}